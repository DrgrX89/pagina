<!doctype html>
<html lang="es">
<head>
	<meta charset="utf-8">
	<meta name="viewport" content="width=device-width,initial-scale=1">
	<title>Video</title>
	
	<link rel="stylesheet" href="css/base.css">
	<link rel="stylesheet" href="css/video.css"> 
</head>
<body class="bg-video">
	<h2>Video Speach</h2>
	<div class="container">
		<div class="video-wrap">
			<video id="player" controls preload="metadata" src="Imagenes/1114.mp4">
				Tu navegador no soporta video HTML5.
			</video>
		</div>

		<aside class="side-panel" id="sidePanel" aria-live="polite">
			<div class="panel-title">Subt√≠tulos</div>
			<div id="loadingMsg" class="loading">Cargando video y subt√≠tulos...</div>
			<div id="current" class="current-sub" aria-atomic="true" style="display:none;"></div>
			<div id="next" class="next-sub" style="display:none;"></div>
			<div class="small">Subtitulos by Nixcobt house requiem.</div>
		</aside>
	</div>

<script>
(function(){
	const video = document.getElementById('player');
	const loadingMsg = document.getElementById('loadingMsg');
	const currentEl = document.getElementById('current');
	const nextEl = document.getElementById('next');

	const showLoading = () => {
		loadingMsg.style.display = 'block';
		currentEl.style.display = 'none';
		nextEl.style.display = 'none';
	};

	const hideLoading = () => {
		loadingMsg.style.display = 'none';
		currentEl.style.display = 'block';
		nextEl.style.display = 'block';
	};

	showLoading();

	video.addEventListener('canplay', () => {
		hideLoading();
	});

	video.addEventListener('error', () => {
		loadingMsg.textContent = 'Error al cargar el video. Revisa la ruta en la Consola (F12).';
	});

	// FUNCION √öNICA: Usa el arreglo de cues en JS
	function setupTextTrackFromArray() {
		// üìù Subt√≠tulos sincronizados con el audio de 1114.mp4 (tiempos en segundos)
		const cues = [
			{ start: 0.0, end: 3.5, text: "Sabemos que no hay nada" }, 
			{ start: 3.5, end: 6.5, text: "como un buen taco para alegrar el d√≠a." }, 
			{ start: 6.5, end: 9.5, text: "As√≠ que creamos Super Taquitos." }, 
			{ start: 9.5, end: 13.0, text: "Un negocio que se encarga de alimentarte con los mejores tacos." } 
		];

		let lastActiveIndex = -1;
		function tick() {
			const t = video.currentTime;
			let found = -1;
			for (let i=0;i<cues.length;i++){
				if (t >= cues[i].start && t < cues[i].end) { found = i; break; }
			}
			if (found !== lastActiveIndex) {
				lastActiveIndex = found;
				if (found === -1) {
					currentEl.textContent = '';
					nextEl.textContent = '';
				} else {
					currentEl.textContent = cues[found].text;
					nextEl.textContent = (found+1 < cues.length) ? ('Siguiente: ' + cues[found+1].text) : '';
				}
			}
		}
		
		setInterval(tick, 200); 
	}

	setupTextTrackFromArray();

	setTimeout(() => {
		if (loadingMsg && loadingMsg.style.display !== 'none' && video.readyState >= 2) {
			hideLoading();
		}
	}, 2500);

})();
</script>
</body>
</html>