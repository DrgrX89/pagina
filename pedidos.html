<!doctype html>
<html lang="es">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width,initial-scale=1">
  <title>Pedidos - Super Taquito</title>

  <link rel="icon" href="Imagenes/logospt.png" type="image/png">
  <link rel="stylesheet" href="css/base.css">
  <link rel="stylesheet" href="css/pedidos.css">
</head>

<body class="bg-pedidos">

<header class="internal-header">
  <a href="dashboard.html" class="logo-link">
    <img src="Imagenes/Logito.png" class="logo" alt="Volver a dashboard">
  </a>
  <h2 class="titulo-pedidos">ðŸ“¦ Lista de Pedidos</h2>
</header>

<section class="pedidos-container">

  <div id="lista-pedidos" class="pedidos-lista"></div>

</section>

<script>
/* ============================================
   LEER LOS PEDIDOS GUARDADOS POR EL CARRITO
============================================ */
const ORDERS_KEY = "st_orders";

function loadOrders() {
  try { 
    return JSON.parse(localStorage.getItem(ORDERS_KEY)) || [];
  } catch {
    return [];
  }
}

/* ============================================
   GUARDAR CAMBIOS (cambiar estado, etc)
============================================ */
function saveOrders(orders) {
  localStorage.setItem(ORDERS_KEY, JSON.stringify(orders));
}

/* ============================================
   RENDERIZAR LISTA DE PEDIDOS
============================================ */
function renderPedidos() {
  const cont = document.getElementById("lista-pedidos");
  const pedidos = loadOrders();

  cont.innerHTML = "";

  if (pedidos.length === 0) {
    cont.innerHTML = `
      <p style="color:white; text-align:center; margin-top:40px;">
        No hay pedidos registrados todavÃ­a.
      </p>`;
    return;
  }

  pedidos.forEach((p, index) => {

    const div = document.createElement("div");
    div.classList.add("pedido-card");

    const estadoColor = p.estado === "completado" ? "#4caf50" : "#ff9800";

    div.innerHTML = `
      <div class="pedido-top">
        <h3>Pedido #${p.id}</h3>
        <span class="estado-tag" style="background:${estadoColor};">${p.estado}</span>
      </div>

      <p><strong>Cliente:</strong> ${p.cliente}</p>
      <p><strong>Fecha:</strong> ${new Date(p.fecha).toLocaleString()}</p>
      <p><strong>Total:</strong> $${p.total.toLocaleString("es-ES")}</p>

      <h4>Productos:</h4>
      <ul class="items-list">
        ${p.items.map(i => `
            <li>${i.cantidad}x ${i.nombre} - $${(i.precio * i.cantidad).toLocaleString("es-ES")}</li>
        `).join("")}
      </ul>

      <button class="btn-estado" data-i="${index}">
        Cambiar estado
      </button>
    `;

    cont.appendChild(div);
  });

  // listeners botones cambiar estado
  document.querySelectorAll(".btn-estado").forEach(btn => {
    btn.addEventListener("click", () => {
      const index = btn.dataset.i;
      cambiarEstado(index);
    })
  });
}

/* ============================================
   CAMBIAR ESTADO DEL PEDIDO
============================================ */
function cambiarEstado(i) {
  const pedidos = loadOrders();

  pedidos[i].estado =
    pedidos[i].estado === "pendiente" ? "completado" : "pendiente";

  saveOrders(pedidos);
  renderPedidos();
}

/* inicializar */
renderPedidos();
</script>

</body>
</html>
